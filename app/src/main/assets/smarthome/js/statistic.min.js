function getBrowser(){var a=navigator.userAgent;if(a.search(/MSIE/)>0){return"MSIE"}if(a.search(/Firefox/)>0){return"Firefox"}if(a.search(/Opera/)>0){return"Opera"}if(a.search(/Chrome/)>0){return"Chrome"}if(a.search(/Safari/)>0){return"Safari"}if(a.search(/Konqueror/)>0){return"Konqueror"}if(a.search(/Iceweasel/)>0){return"Iceweasel"}if(a.search(/SeaMonkey/)>0){return"SeaMonkey"}if(a.search(/Gecko/)>0){return"Gecko"}return"N/A"}function isTouchDevice(){return(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent))}function isDefined(a){return(a!==null&&a!==undefined)}function isUndefined(a){return(a===null||a===undefined)}function isPresent(a){return(a!==null&&a!==undefined&&a!=="")}function removeObject(a){var b=document.getElementById(a);if(b!==null){b.parentNode.removeChild(b)}}function noCallback(a){}function uniqueKey(a){var c={};for(var b=0;b<a.length;b++){var d=a[b];c[d]=true}return Object.keys(c)}function getTimeFormatUTC(d){var b=Date.parse(d);var e="en-US";var a={year:"numeric",month:"long",day:"numeric",timezone:"UTC",hour:"numeric",minute:"numeric",second:"numeric"};var c=isNaN(b)?"&#8226;":new Date(b).toLocaleString(e,a);return c}function getServerSensorData(a,b){$.ajax({type:"GET",url:a,dataType:"json"}).done(function(c){if(c.status==="ZERO_RESULTS"){console.error("Error of performance | status : ZERO_RESULTS")}else{b(c)}}).error(function(){console.error("Error of performance")})}var MAX_ATTEMPS=3;var FIELD_HOT_WATER="field1";var FIELD_HUMIDITY="field3";var FIELD_FAN="field4";var interval=30;var attempts_connection=MAX_ATTEMPS;var percent40=0;var percent45=0;function sendRequestForCloudMinMaxData(b,a){var c={t1:60,t2:720,t3:43200,day:680};$("#statistic_cool_water").append('<div id="spinner" class="graph_spinner"></div>');getServerSensorData("https://api.thingspeak.com/channels/"+CHANNEL+"/feeds.json?results="+c[a],formatStatisticData)}function formatStatisticData(f){var d=f.feeds;var e=[];var h=[];var c=[];var b={};var j="";var a=0;var g=0;$("#spinner").fadeOut("slow",function(){removeObject("spinner");for(i=0;i<d.length;++i){if(!isNaN(d[i][FIELD_HOT_WATER])){var n=d[i]["created_at"];var k=d[i][FIELD_HOT_WATER];var l=moment(n).format("YYYY-MM-DD");var p=moment(n).format("HH");var o=l+" | "+p+":"+getRoundMin(n);if(k>=40&&k<45){a++}if(k>=45){g++}if(j!==o){j=o;e=new Array()}h.push(Math.round(k));c.push(moment(n).format("DD MMMM"));e.push({date:moment(n).format("DD.MMM"),time:p+":"+getRoundMin(n),firstHAH:isFirstHalfAnHour(n),hwt:Math.round(k),humidity:Math.round(d[i][FIELD_HUMIDITY]),fan:Math.round(d[i][FIELD_FAN])});b[o]=e}}updateStatisticData(b,maxValue);var m=uniqueKey(c).toString().replace(","," &#8226; ")+" &#8226; "+moment(d[d.length-1]["created_at"]).format("YYYY");var q=moment(d[d.length-1]["created_at"]).format("MMMM");var r='<div class="ds stats"><div class="cs_label_stats">duration<div class="icon t">-</div>> 40&deg;C &#8226; <span>'+parseFloat(a/d.length*100).toFixed(1)+'%</span> <div class="icon t">-</div>> 45&deg;C &#8226; <span>'+parseFloat(g/d.length*100).toFixed(1)+"%</span></div></div>";$(".cs_graph_date").html((c[0].indexOf(q+1)?m=m.replace(q,""):m));$("#stats").html('<div class="ds stats"><div class="header_stats"></div></div><div class="ds stats"><div id="statusLabel" class="cs_label_stats">Temperature Min &#8226; <span>'+Math.min.apply(null,h)+"&deg;C</span> Avg &#8226; <span>"+getAverageValueOfArray(h)+"&deg;C</span> Max &#8226; <span>"+Math.max.apply(null,h)+'&deg;C</span></div></div><div class="ds stats"><div id="statusLabel" class="cs_label_stats"><div class="icon t">-</div>Hot Water &#8226; <span>'+parseFloat(d[d.length-1][FIELD_HOT_WATER]).toFixed(1)+'&deg;C</span> <div class="icon h">-</div>Humidity &#8226; <span>'+parseFloat(d[d.length-1][FIELD_HUMIDITY]).toFixed(1)+"%</span></div></div>"+r)})}function updateStatisticData(g,f){var e="";for(key in g){var d=g[key];var a=new Array();var b=new Array();var c=new Array();for(i=0;i<d.length;++i){a.push(d[i].hwt);b.push(d[i].humidity);c.push(d[i].fan)}e+='<div class="box_val">'+createGraph(d[0]["date"],d[0]["time"],d[0]["firstHAH"],a,b,c)+"</div>"}$("#graph").html(e);$("#interval_val").html("set interval statistic value &#8226; "+interval+" min");$("#graph_wrapper").toggleClass("x_mask",!$("#i30").hasClass("select"))}function isFirstHalfAnHour(a){return(Math.floor(parseInt(moment(a).format("mm"))/interval)===0)}function getRoundMin(a){return Math.floor(parseInt(moment(a).format("mm"))/interval)}function createGraph(t,g,r,j,n,q){maxValue=50;var c=Math.max.apply(null,j);var a=getAverageValueOfArray(j);var k=Math.min.apply(null,j);var d=Math.max.apply(null,n);var e=Math.min.apply(null,n)-2;var o=(Math.max.apply(null,q)===1);var p=Math.round(c/maxValue*100);var h=Math.round(a/maxValue*100);var l=Math.round(k/maxValue*100);var b=getTimeLabel(t,g,r);var f=(d-e);var s=(c>=40)?" hot_water":"";var m='<div class="val_max'+s+'" style="height:'+p+'%;"></div><div class="val_avg" style="height:'+h+'%;"></div><div class="val_min" style="height:'+l+'%;"></div><div class="box_humidity"><div class="val_max_h" style="border-top-width:'+f+"px; height:"+d+'%; "></div>'+(o?'<div class="cs_fan_on"></div>':"")+"</div>"+b;return m}function getTimeLabel(b,f,c){var g="";var a=3;var e=" cs_style_min";var d=f.substr(3,f.length);if(c){if(interval<15){a=1}if(interval===15){a=2}var h=parseInt(f.substr(0,2))%a===0;g=h?(f.substr(0,3)==="00:"?b:f.substr(0,3)+"00"):"";e=""}else{if(interval<15){if(d==="5"){g=f.substr(0,3)+"20"}if(d==="10"){g=f.substr(0,3)+"40"}}}style_label=(f==="00:0")?" cs_style_date":e;return(g==="")?"":'<div class="cs_time_label'+style_label+'"><span>&#8226;</span>'+g+"</div>"}var WEB_URL="http://192.168.1.77";var CHANNEL=117345;var TOUCH_DEVICE=true;var maxValue=50;var lastGraph="t2";interval=15;window.onload=function(){document.addEventListener("touchmove",function(a){a.preventDefault()},false);window.setTimeout(function(){showUI()},100);TOUCH_DEVICE=isTouchDevice()};function showUI(){$("#statistic_cool_water").html('<div id="chart_grid" class="cs_chart"></div><div class="graph_container"><div id="graph_wrapper" class="wrapper"><div class="scroller_x_auto"><div id="graph" class="cs_graph_content"></div></div></div></div><div id="average" class="cs_graph_title cs_button" tabindex="0" onclick="clickShowOnlyAverage(event);">Temperature Hot Water</div><div class="cs_graph_title humidity">Humidity and <div class="icon fan">-</div> Power Fan On</div>');createGridDisplay(maxValue);var a=document.getElementById("win");if(a!=null){a.classList.add("css-fade")}sendRequestForCloudMinMaxData(lastGraph,"day");window.setInterval(function(){sendRequestForCloudMinMaxData(lastGraph,"day")},120000)}function createGridDisplay(g){var f=10;var e="";for(var d=f;d>=0;d--){var b=(d>4)?(d*Math.floor(g/f)+"&deg;C"):(d*25)+"%";var a=(d>7)?' style="color:#C03;"':"";var c=(d===4)?' style="opacity:0;"':"";e+='<div class="cs_item_grid"'+c+'><div class="grid_label"'+a+">"+b+'</div><div class="grid_label right"'+a+">"+b+"</div></div>"}$("#chart_grid").html(e)}function getAverageValueOfArray(c){var b=0;for(var a=0;a<c.length;a++){b+=parseInt(c[a])}return Math.floor(b/c.length)}function nextGraph(a){a.stopPropagation();var b=a.target.id.replace("i","");interval=parseInt(b);if(isNaN(interval)){return}$(".cs_btn_ui").toggleClass("select",false);$(a.target).toggleClass("select",true);$("#average").toggleClass("select",false);showOnlyAverage();console.info("interval =",interval);window.setTimeout(function(){sendRequestForCloudMinMaxData(lastGraph,"day")},100)}function clickShowOnlyAverage(a){a.stopPropagation();$(a.target).toggleClass("select");showOnlyAverage()}function showOnlyAverage(){var a=$("#average").hasClass("select");var b=a?"Average Temperature Hot Water":"Temperature Hot Water";$("#average").html(b);$(".val_max").toggleClass("hide",a);$(".val_min").toggleClass("hide",a);$(".val_avg").toggleClass("only_avg",a)};