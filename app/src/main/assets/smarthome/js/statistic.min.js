function getBrowser(){var a=navigator.userAgent;if(a.search(/MSIE/)>0){return"MSIE"}if(a.search(/Firefox/)>0){return"Firefox"}if(a.search(/Opera/)>0){return"Opera"}if(a.search(/Chrome/)>0){return"Chrome"}if(a.search(/Safari/)>0){return"Safari"}if(a.search(/Konqueror/)>0){return"Konqueror"}if(a.search(/Iceweasel/)>0){return"Iceweasel"}if(a.search(/SeaMonkey/)>0){return"SeaMonkey"}if(a.search(/Gecko/)>0){return"Gecko"}return"N/A"}function isTouchDevice(){return(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent))}function isDefined(a){return(a!==null&&a!==undefined)}function isUndefined(a){return(a===null||a===undefined)}function isPresent(a){return(a!==null&&a!==undefined&&a!=="")}function removeObject(a){var b=document.getElementById(a);if(b!==null){b.parentNode.removeChild(b)}}function noCallback(a){}function uniqueKey(a){var c={};for(var b=0;b<a.length;b++){var d=a[b];c[d]=true}return Object.keys(c)}function getTimeFormatUTC(d){var b=Date.parse(d);var e="en-US";var a={year:"numeric",month:"long",day:"numeric",timezone:"UTC",hour:"numeric",minute:"numeric",second:"numeric"};var c=isNaN(b)?"&#8226;":new Date(b).toLocaleString(e,a);return c}function getServerSensorData(a,b){$.ajax({type:"GET",url:a,dataType:"json"}).done(function(c){if(c.status==="ZERO_RESULTS"){console.error("Error of performance | status : ZERO_RESULTS")}else{b(c)}}).error(function(){console.error("Error of performance")})}var MAX_ATTEMPS=3;var FIELD_HOT_WATER="field1";var FIELD_HUMIDITY="field3";var FIELD_FAN="field4";var interval=30;var attempts_connection=MAX_ATTEMPS;var percent40=0;var percent45=0;function sendRequestForCloudMinMaxData(b,a){var c={t1:60,t2:720,t3:43200,day:680};$("#statistic_cool_water").append('<div id="spinner" class="graph_spinner"></div>');getServerSensorData("https://api.thingspeak.com/channels/"+CHANNEL+"/feeds.json?results="+1080,formatStatisticData)}function formatStatisticData(f){var d=f.feeds;var e=[];var h=[];var c=[];var b={};var i="";var a=0;var g=0;$("#spinner").fadeOut("slow",function(){removeObject("spinner");for(var q=0;q<d.length;++q){if(!isNaN(d[q][FIELD_HOT_WATER])){var l=d[q].created_at;var s=d[q][FIELD_HOT_WATER];var o=moment(l).format("YYYY-MM-DD");var m=moment(l).format("HH");var t=o+" | "+m+":"+getRoundMin(l);if(s>=40&&s<45){a++}if(s>=45){g++}if(i!==t){i=t;e=[]}h.push(Math.round(s));c.push(moment(l).format("DD MMMM"));e.push({date:moment(l).format("DD.MMM"),time:m+":"+getRoundMin(l),firstHAH:isFirstHalfAnHour(l),hwt:Math.round(s),humidity:Math.round(d[q][FIELD_HUMIDITY]),fan:Math.round(d[q][FIELD_FAN])});b[t]=e}}updateStatisticData(b,maxValue);var n=uniqueKey(c).toString().replace(","," &#8226; ")+" &#8226; "+moment(d[d.length-1]["created_at"]).format("YYYY");var k=moment(d[d.length-1]["created_at"]).format("MMMM");var r='<div class="ds stats"><div class="cs_label_stats">duration<div class="icon t">-</div>> 40&deg;C &#8226; <span>'+parseFloat(a/d.length*100).toFixed(1)+'%</span> <div class="icon t">-</div>> 45&deg;C &#8226; <span>'+parseFloat(g/d.length*100).toFixed(1)+"%</span></div></div>";var p=parseFloat(d[d.length-1][FIELD_HOT_WATER]).toFixed(1);var j=p>36?p>44?" hot":" warm":"";$(".cs_graph_date").html((c[0].indexOf(k+1)?n=n.replace(k,""):n));$("#stats").html('<div class="ds stats"><div class="header_stats'+j+'"></div></div><div class="ds stats"><div id="statusLabel" class="cs_label_stats">Temperature Min &#8226; <span>'+Math.min.apply(null,h)+"&deg;C</span> Avg &#8226; <span>"+getAverageValueOfArray(h)+"&deg;C</span> Max &#8226; <span>"+Math.max.apply(null,h)+"&deg;C</span></div></div>"+r);$("#hw_val").html("• "+p+"°C");$("#h_val").html("• "+parseFloat(d[d.length-1][FIELD_HUMIDITY]).toFixed(1)+"%")})}function updateStatisticData(a,d){var e="";for(var j in a){var f=a[j];var b=[];var g=[];var h=[];for(var c=0;c<f.length;++c){b.push(f[c].hwt);g.push(f[c].humidity);h.push(f[c].fan)}e+='<div class="box_val">'+createGraph(f[0]["date"],f[0]["time"],f[0]["firstHAH"],b,g,h)+"</div>"}$("#graph").html(e);$("#interval_val").html("set interval statistic value &#8226; "+interval+" min");$("#graph_wrapper").toggleClass("x_mask",!$("#i30").hasClass("select"))}function isFirstHalfAnHour(a){return(Math.floor(parseInt(moment(a).format("mm"))/interval)===0)}function getRoundMin(a){return Math.floor(parseInt(moment(a).format("mm"))/interval)}function createGraph(s,g,q,i,m,p){maxValue=50;var c=Math.max.apply(null,i);var a=getAverageValueOfArray(i);var j=Math.min.apply(null,i);var d=Math.max.apply(null,m);var e=Math.min.apply(null,m)-2;var n=(Math.max.apply(null,p)===1);var o=Math.round(c/maxValue*100);var h=Math.round(a/maxValue*100);var k=Math.round(j/maxValue*100);var b=getTimeLabel(s,g,q);var f=(d-e);var r=(c>=40)?" hot_water":"";var l='<div class="val_max'+r+'" style="height:'+o+'%;"></div><div class="val_avg" style="height:'+h+'%;"></div><div class="val_min" style="height:'+k+'%;"></div><div class="box_humidity"><div class="val_max_h" style="border-top-width:'+f+"px; height:"+d+'%; "></div>'+(n?'<div class="cs_fan_on"></div>':"")+"</div>"+b;return l}function getTimeLabel(d,c,b){var g="";var h=3;var f=" cs_style_min";var a=c.substr(3,c.length);if(b){if(interval<15){h=1}if(interval===15){h=2}var i=parseInt(c.substr(0,2))%h===0;g=i?(c.substr(0,3)==="00:"?d:c.substr(0,3)+"00"):"";f=""}else{if(interval<15){if(a==="5"){g=c.substr(0,3)+"20"}if(a==="10"){g=c.substr(0,3)+"40"}}}var e=(c==="00:0")?" cs_style_date":f;return(g==="")?"":'<div class="cs_time_label'+e+'"><span>&#8226;</span>'+g+"</div>"}var WEB_URL="http://192.168.1.77";var CHANNEL=117345;var TOUCH_DEVICE=true;var maxValue=50;var lastGraph="t2";interval=15;window.onload=function(){document.addEventListener("touchmove",function(a){a.preventDefault()},false);TOUCH_DEVICE=isTouchDevice();showUI();window.setTimeout(function(){$(".overlay").fadeOut("slow")},2500)};function showUI(){$("#statistic_cool_water").html('<div id="chart_grid" class="cs_chart"></div><div class="graph_container"><div id="graph_wrapper" class="wrapper"><div class="scroller_x_auto"><div id="graph" class="cs_graph_content"></div></div></div></div><div id="hw_val" class="cs_val hw">33.0°C</div><div id="h_val" class="cs_val h">35.0%</div><div id="average" class="cs_graph_title cs_button" tabindex="0" onclick="clickShowOnlyAverage(event);">Temperature Hot Water</div><div class="cs_graph_title humidity">Humidity and <div class="icon fan">-</div> Power Fan On</div>');createGridDisplay(maxValue);sendRequestForCloudMinMaxData(lastGraph,"day");window.setInterval(function(){sendRequestForCloudMinMaxData(lastGraph,"day")},120000)}function createGridDisplay(g){var f=10;var e="";for(var d=f;d>=0;d--){var b=d>4?d*Math.floor(g/f)+"&deg;C":d*25+"%";var a=d>7?' style="color:#C03;"':"";var c=d===4?' style="opacity:0;"':"";e+='<div class="cs_item_grid"'+c+'><div class="grid_label"'+a+">"+b+'</div><div class="grid_label right"'+a+">"+b+"</div></div>"}$("#chart_grid").html(e)}function getAverageValueOfArray(c){var b=0;for(var a=0;a<c.length;a++){b+=parseInt(c[a])}return Math.floor(b/c.length)}function nextGraph(a){a.stopPropagation();var b=a.target.id.replace("i","");interval=parseInt(b);if(isNaN(interval)){return}$(".cs_btn_ui").toggleClass("select",false);$(a.target).toggleClass("select",true);$("#average").toggleClass("select",false);showOnlyAverage();console.info("interval =",interval);window.setTimeout(function(){sendRequestForCloudMinMaxData(lastGraph,"day")},100)}function clickShowOnlyAverage(a){a.stopPropagation();$(a.target).toggleClass("select");showOnlyAverage()}function showOnlyAverage(){var a=$("#average").hasClass("select");var b=a?"Average Temperature Hot Water":"Temperature Hot Water";$("#average").html(b);$(".val_max").toggleClass("hide",a);$(".val_min").toggleClass("hide",a);$(".val_avg").toggleClass("only_avg",a)};