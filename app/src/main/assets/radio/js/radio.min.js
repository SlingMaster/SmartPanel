/*! (c) Developer Alex Dovby 
radio Release It is Created 08.12.2020 - 18:06:56,93 
version 08.12.2020 */
;var EVT_LIST=1100;var EVT_LIST=1100;var EVT_SAVE_PREFS=1101;var EVT_MUTE=1102;var CMD_FM_DATA=1110;var CMD_RADIO_PREV=1115;var CMD_RADIO_MUTE=1116;var CMD_RADIO_NEXT=1117;var CMD_RADIO_FAV1=1111;var CMD_RADIO_FAV2=1112;var CMD_RADIO_FAV3=1113;var CMD_RADIO_FAV4=1114;var withAPP=false;var radioList;var mute=false;var sound;var lastIndex=-2;var curIndex=1;var defMode=true;var last_state=false;var next_freq=0;var last_freq=0;var cycleID=0;var favorites=[];var list_url="http://192.168.1.2/DEV_UI/SmartPanel/radio/fm_radio.json";window.onload=function(){withAPP=isNativeApplication();curIndex-=1;if(!withAPP){radioList=loadJSON(list_url).fm;resumeAppState();initUI();addOnmessageEventsListener()}else{sendRequestToNativeApp(EVT_READY,{browser:getBrowser(),ui:"project_radio"})}console.info("HTML onload")};function initUI(){createUI();setMute(true);window.setTimeout(function(){$(".overlay").fadeOut("slow",function(){});this.setInterval(setDigitalTime,1000)},2500);ResizeWidget();nextStation();$("ul li").eq(curIndex).toggleClass("select",true)}function createUI(){$("#content").html('<div class="box"><div id="pos_content" class="pos_box"><div id="fav_box" class="favorites"></div></div><div id="analog" class="cs_content"><div id="gear_big" class="gear_big"></div><div id="gear_litle" class="gear_litle"></div><div class="cs_widget"><div id="cur_freq" class="cur_marker"></div><div id="set_freq" class="regulator" onclick="next(event)"><div id="prev" class="prev" onclick="onClickPrev(event)"></div></div></div></div><div id="radio_contect" class="display"><div id="date" class="time_desc">•</div><div id="freq" class="fm"> </div><div id="station" class="time_desc litle"></div><div id="btn_fav" class="fav_btn" onclick="onClickFavorites(event)"></div><div id="mute" class="mute_btn" onclick="onClickMute(event)"></div></div></div></div>');createListFM();setStateControls()}function createListFM(){var b="";for(var a=0;a<radioList.length;a++){b+="<li>"+radioList[a].title+"</li>"}$("#fm_list").html('<ul id="fm_container">'+b+"</ul>");$("#fm_container").css("width",radioList.length*120+120+"px");createFavoritesList()}function setStateControls(){var c=defMode?675:765;var b=uniqueVal(favorites,curIndex);$("#btn_fav").css("opacity",b?0.5:1);$("#fm_container").css("left",c-curIndex*120+"px");for(var a=0;a<radioList.length;a++){if(a<curIndex-2||a>curIndex+1){$("ul li").eq(a).css("opacity",0)}else{$("ul li").eq(a).css("opacity",1)}$("ul li").eq(a).toggleClass("select",a===curIndex)}$("ul li").eq(curIndex).toggleClass("select",true)}window.onresize=function(){ResizeWidget()};function next(a){a.stopPropagation();if(defMode){defMode=false;swapDigitalAnalog()}curIndex+=1;nextStation()}function onClickPrev(a){a.stopPropagation();if(defMode){defMode=false;swapDigitalAnalog()}curIndex-=1;nextStation()}function nextStation(){if(curIndex>=radioList.length){curIndex=0;$("ul li").css("opacity",0)}if(curIndex<0){curIndex=0}var a=(360/radioList.length)*curIndex;next_freq=parseFloat(radioList[curIndex].freq);clearInterval(cycleID);cycleID=setInterval(setFreq,10);$("#set_freq").css("-webkit-transform","rotate("+a+"deg)");$("#prev").css("-webkit-transform","rotate("+-a+"deg)");$("#gear_litle").css("-webkit-transform","rotate("+-a*0.5+"deg)");$("#gear_big").css("-webkit-transform","rotate("+a+"deg)");if(defMode){playRadio(curIndex)}}function setFreq(){if(next_freq>last_freq){last_freq+=0.1}else{if(next_freq<last_freq){last_freq-=0.1}}if(parseFloat(next_freq).toFixed(1)===parseFloat(last_freq).toFixed(1)){clearInterval(cycleID);last_freq=next_freq;setStateControls()}$("#freq").html(formatSS(parseFloat(last_freq).toFixed(1),5," "))}function setMute(a){if(isUndefined(a)){mute=!mute}else{mute=a}console.info("set mute • "+mute+" | flag "+a);$("#mute").toggleClass("select",mute);if(sound){if(mute){sound.fade(1,0,2000)}else{mute=false;sound.fade(0,1,2000)}sendRequestToNativeApp(EVT_MUTE,{state:mute})}}function playRadio(a){var c=radioList[a];if(lastIndex!==a){if(sound){setMute(true);sound.unload()}if(c.howl){sound=c.howl}else{sound=c.howl=new Howl({src:c.src,html5:true,format:["mp3","aac","mpeg"]})}last_freq=parseFloat(c.freq);setMute(false);sound.play();lastIndex=a}var b=(360/radioList.length)*curIndex;$("#cur_freq").css("-webkit-transform","rotate("+b+"deg)");setStateControls();saveAppState()}function ResizeWidget(){var d=Math.min(window.innerWidth,window.innerHeight)/800;d=Math.min($("#win").innerWidth(),$("#win").innerHeight())/720;var b=defMode?0.65:1;var a=defMode?1:0.75;var e=defMode?-108:-95;var c=defMode?-22:-10;$("#analog").css("transform","translate("+Math.floor(e)+"%, -50%) scale("+d*b+")");$("#radio_contect").css("transform","translate("+Math.floor(c)+"%, -50%) scale("+d*a+")");$("#date").css("color",defMode?"#84ffff":"#FFFFFF");$("#freq").css("color",defMode?"#FFFFFF":"#84ffff");$("#pos_content").css("opacity",defMode?0:1);$("#station").css("font-size",defMode?"36px":"24px");$(".bg").css("background-position",defMode?"center 72%":"center 45%");window.setTimeout(function(){$("#cur_freq").css("background-size",defMode?"90% auto":"100% auto")},defMode?2500:1);last_state=defMode}function setDigitalTime(){if(defMode){var f=["January","February","March","April","May","June","July","August","September","October","November","December"];var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var c=new Date();var a=c.getHours();var d=c.getMinutes();var e=c.getSeconds();$("#date").html('<div class="time_desc">'+c.getDate()+", "+f[c.getMonth()]+" "+c.getFullYear()+" • "+b[c.getDay()]+" • "+formatXX(a,2)+"<span>:</span>"+formatXX(d,2)+"<span>:</span>"+formatXX(e,2)+"</div>")}}function onClickSettings(a){a.stopPropagation();sendRequestToAplication(EVT_SETTINGS,"settings",{})}function onClickSwap(a){a.stopPropagation();defMode=!defMode;swapDigitalAnalog();if(defMode){playRadio(curIndex)}}function swapDigitalAnalog(){console.info("swapDigitalAnalog | defMode "+defMode);ResizeWidget()}function init(d){var b;if(isDefined(d.prefs)){b=JSON.parse(d.prefs);curIndex=b.cur_index||0;if(isDefined(b.favorites)){var a=b.favorites.split(",");for(var c=0;c<a.length;c++){favorites.push(a[c])}}console.info("INIT | jsonData : "+d.prefs+" Favorites : "+JSON.stringify(favorites))}sendRequestToNativeApp(EVT_LIST,{})}function JavaScriptCallback(c,b){var a=b[RESPONSE_JSON]||{};switch(c){case CMD_INIT:init(a);break;case CMD_BACK:backEvent();break;case CMD_WEATHER_DATA:break;case CMD_FM_DATA:radioList=a.fm;initUI();nextStation();break;case CMD_RADIO_PREV:curIndex-=1;nextStation();break;case CMD_RADIO_MUTE:defMode=!defMode;ResizeWidget();setMute(!defMode);break;case CMD_RADIO_NEXT:curIndex+=1;nextStation();break;case CMD_RADIO_FAV1:nextFavorites(0);break;case CMD_RADIO_FAV2:nextFavorites(1);break;case CMD_RADIO_FAV3:nextFavorites(2);break;case CMD_RADIO_FAV4:nextFavorites(3);break;case CMD_SWAP:defMode=!defMode;ResizeWidget();break;case CMD_REDIRECT:break;case EVT_EXO:break;default:console.info("[ ] JavaScriptCallback command "+c+" not present");break}}function onClickMute(a){a.stopPropagation();setMute()}function onClickFavorites(a){a.stopPropagation();if(uniqueVal(favorites,curIndex)){favorites.push(curIndex);if(favorites.length>4){favorites.splice(0,1)}createFavoritesList();saveAppState()}}function createFavoritesList(){var b="";if(isDefined(favorites)){for(var a=0;a<favorites.length;a++){b+='<button id="fav'+Number(favorites[a])+'" class="fav_st" onclick="playFavorites(event)">'+radioList[Number(favorites[a])].title+"</button>"}$("#fav_box").html('<button class="fav_st label" >favorites •</button>'+b)}}function playFavorites(a){a.stopPropagation();curIndex=parseInt(a.target.id.substr(3),10);nextStation();window.setTimeout(function(){defMode=true;swapDigitalAnalog();playRadio(curIndex)},2000)}function nextFavorites(a){var b=favorites[a];if(isDefined(b)){curIndex=b;playRadio(curIndex)}$("#json-cmd").html("id : "+b+" | IDX "+a)}function uniqueVal(a,b){return a.join().indexOf(""+b)>=0?false:true}function formatSS(c,b,a){while(c.length<b){c=a+c}return c}function supportsHtml5Storage(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}}function resumeAppState(){console.warn("resumeAppState");if(!supportsHtml5Storage()){console.warn("Not supports Local Storage")}else{if(localStorage.favorites!==null){if(isDefined(localStorage.favorites)){favorites=localStorage.favorites.split(",");if(localStorage.cur_index!==null){curIndex=localStorage.cur_index}else{curIndex=0}console.info("favorites : "+favorites[0]+" | cur_index : "+curIndex)}}}}function saveAppState(){if(supportsHtml5Storage()){localStorage.favorites=favorites.join();localStorage.cur_index=curIndex;console.info("saveAppState | favorites : ",localStorage.favorites+" | cur_index : "+curIndex)}else{var a={favorites:favorites.join()||null,cur_index:curIndex};console.info("saveAppState | sendData : "+JSON.stringify(a));sendRequestToNativeApp(EVT_SAVE_PREFS,a)}}function onClickTest(a){a.stopPropagation();favorites.length=0;location.reload(true)};